<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../lib/css/bootstrap.css">
</head>

<body>
    <div class="container">
        <form action="checkRegister.php" method="post">
            <div class="form-group">
                <label for="username">用户名：
                    <img src="../lib/images/close.png" alt="" id="eye">
                </label>
                <input type="text" class="form-control" placeholder="请输入用户名" name="username" id=username>
            </div>
            <div class="form-group">
                <button class="btn-light" id="checkname">检测用户名</button>
            </div>
            <div class="form-check">
                <label class="form-check-label">
                    <input class="form-check-input" type="checkbox"> 七天免登录
                </label>
            </div>
            <div class="form-group">
                <label for="password">密码：
                    <img src="../lib/images/close.png" alt="" id="eye">
                </label>
                <input type="password" class="form-control" placeholder="请输入密码" name="password" id="password">
                <p class="message">请输入6~16位密码</p>
            </div>
            <span><img src="" class="eye"></span>
            <div class="form-group">确认密码：
                <label for="confirm-password">
                    <img src="images/close.png" alt="" id="eye">
                </label>
                <input type="password" class="form-control" placeholder="请再次输入密码" name="confirm-password"
                    id="confirm-password">
            </div>
            <span><img src="" class="eye"></span>
            <div class="form-check">
                <label class="form-check-label">
                    <input class="form-check-input" type="checkbox"> 七天内自动登录
                </label>
            </div>
            <button type="reset" class="btn btn-primary">重置</button>
            <button type="submit" class="btn btn-primary">提交</button>
        </form>
    </div>
    <script>
        let eye = document.querySelector('.eye');
        let password = document.querySelector('#password');
        let flag = false;
        eye.onclick = function () {
            if (flag == false) {
                password.type = 'text';
                eye.src = '../lib/image/open.png';
                flag = true;
            } else {
                password.type = 'password';
                eye.src = '../lib/image/close.png';
                flag = false;
            }
        }
        password.onblur = function () {
            if (password.value.length < 6 || password.value.length > 16) {
                message.className = "message wrong";
                message.innerHTML = "输入的密码位数不符，要求是6到16位";
            } else {
                message.className = "message right";
                message.innerHTML = "密码正确";
            }
        }
        let check = document.querySelector('#checkname');
        let name = document.getElementById("checkname").value;
        check.onclick = function () {
            // 1.创建XMLHttpRequest对象
            let xhr = new XMLHttpRequest();

            // 2.请求行
            xhr.open("POST", "./checkname.php");

            // 3.请求头
            xhr.setRequestHeader('Content-Type', ' application/x-www-form-urlencoded');

            // 4.设置数据
            xhr.send("name=" + name);

            // 5.监听服务器响应
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    if (xhr.responseText == '1') {
                        //如果服务器传回的内容为y，则表示用户名已经被占用
                        alert('该用户名已被他人使用！');
                    } else {
                        //不为y，则表明用户名未被占用
                        alert('恭喜，该用户名未被使用！');
                    }
                }
            }
        }
    </script>
</body>

</html>